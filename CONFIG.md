# Configuration Reference

All configuration settings, environment variables, and their locations for this Supabase project.

**Official Reference:** https://supabase.com/docs/guides/self-hosting

---

## Configuration Files

### Primary Configuration
- **`supabase/config.toml`** - Master configuration for all Supabase services (database, API, auth, realtime, storage, edge functions, analytics). All settings reference official Supabase CLI config schema.
- **`.env`** - Local environment secrets and API keys. Never committed to git. Template available in `.env.example`.
- **`package.json`** - npm scripts for database operations, migrations, edge functions, testing, and type generation.

### TypeScript & Code Quality
- **`tsconfig.json`** - TypeScript compiler settings (strict mode, module: nodenext, JSX: react-jsx).
- **`supabase/functions/deno.json`** - Deno runtime configuration for edge functions (import maps, lint/format rules, test patterns).
- **`.sqlfluff`** - SQL linting rules (PostgreSQL dialect, lowercase policy, 120 char line length).

### Docker & Services
- **`docker-compose.override.yml`** - Local Docker overrides for SAML SSO enablement and custom service configurations.
- **`docker-compose.cli-generated.yml`** - Auto-generated by Supabase CLI during `supabase start`. Do not edit manually.

### IDE Configuration
- **`.vscode/settings.json`** - VS Code Deno enablement for `supabase/functions` directory, formatter settings, unstable features.
- **`.vscode/extensions.json`** - Recommended VS Code extensions (Deno extension).

### CI/CD
- **`.github/workflows/claude-code-review.yml`** - Claude AI PR code reviews on pull request events.
- **`.github/workflows/claude-general.yml`** - Claude workflow assistant for issue/PR comments.
- **`.github/workflows-2/*`** - Inactive comprehensive CI/CD workflows (deploy, testing, linting, security).

### Git
- **`.gitignore`** - Excludes `.env`, build artifacts, node_modules, Docker volumes, certificates.

---

## Core Settings (supabase/config.toml)

**Source:** `supabase/config.toml` (351 lines), https://supabase.com/docs/guides/local-development/cli/config

### Project
- **`project_id`** - Distinguishes different Supabase projects on same host. Defaults to working directory name when running `supabase init`. Current value: "SkogAI".

### API Settings (`[api]`)
- **`port`** - API server port (default: 54321). All REST, Auth, Storage, Realtime endpoints accessible via this port.
- **`schemas`** - Exposed schemas in REST API (default: ["public", "graphql_public"]). Tables/views/procedures in these schemas get API endpoints.
- **`extra_search_path`** - Schemas added to PostgreSQL search path for unqualified object references (default: ["public", "extensions"]).
- **`max_rows`** - Maximum rows returned from views/tables/procedures (default: 1000). Limits payload size for malicious requests.
- **`api.tls.enabled`** - Enable HTTPS endpoints locally using self-signed certificate (default: true).

### Database (`[db]`)
- **`db.port`** - Direct PostgreSQL connection port (default: 54322). For psql, migrations, admin operations.
- **`db.shadow_port`** - Port for shadow database used by `supabase db diff` command (default: 54320).
- **`db.major_version`** - PostgreSQL major version (default: 17). Must match remote database version for production compatibility.

### Connection Pooler (`[db.pooler]`)
- **`db.pooler.enabled`** - Enable PgBouncer connection pooler (default: true). Reduces connection overhead for serverless/edge workloads.
- **`db.pooler.port`** - Pooler connection port (default: 54329).
- **`db.pooler.pool_mode`** - When server connections can be reused (options: "transaction", "session"). Transaction mode = connection released after each transaction.
- **`db.pooler.default_pool_size`** - Server connections allowed per user/database pair (default: 20).
- **`db.pooler.max_client_conn`** - Maximum client connections allowed (default: 100).

### Vault (`[db.vault]`)
- **`db.vault.secret_key`** - Encryption key for Supabase Vault encrypted secrets. Generated during `supabase init`, never commit to git.

### Migrations (`[db.migrations]`)
- **`db.migrations.enabled`** - Apply migrations during `db push` or `db reset` (default: true).
- **`db.migrations.schema_paths`** - Glob patterns for schema files (default: ["./migrations/*.sql"]). Ordered list describing database schema.

### Seed Data (`[db.seed]`)
- **`db.seed.enabled`** - Load seed data after migrations during `db reset` (default: true).
- **`db.seed.sql_paths`** - Glob patterns for seed files (default: ["./seed.sql"]). Ordered list of SQL files with test data.

### Network Restrictions (`[db.network_restrictions]`)
- **`db.network_restrictions.enabled`** - Enable IP allowlist for database connections (default: false). Use for production security.
- **`db.network_restrictions.allowed_cidrs`** - IPv4 CIDR blocks allowed to connect (default: ["0.0.0.0/0"] = all). Set empty array to block all IPv4.
- **`db.network_restrictions.allowed_cidrs_v6`** - IPv6 CIDR blocks allowed to connect (default: ["::/0"] = all).

### Realtime (`[realtime]`)
- **`realtime.enabled`** - Enable realtime subscriptions for database changes (default: true). Tables must be added to `supabase_realtime` publication.
- **`realtime.ip_version`** - Bind realtime via IPv4 or IPv6 (default: IPv4).
- **`realtime.max_header_length`** - Maximum HTTP request header length in bytes (default: 4096).

### Studio (`[studio]`)
- **`studio.enabled`** - Enable Supabase Studio web interface (default: true).
- **`studio.port`** - Studio web interface port (default: 8000).
- **`studio.api_url`** - External API URL for frontend connections (current: "https://tavern.skogai.se"). Used for production API references.
- **`studio.OPENAI_API_KEY`** - OpenAI API key for AI features in Studio (format: `env(OPENAI_API_KEY)`). Reads from environment variable.

### Email Testing (`[inbucket]`)
- **`inbucket.enabled`** - Enable local email testing server (default: false). Emails not actually sent, viewable in web interface.
- **`inbucket.port`** - Email testing web interface port (default: 54324).
- **`inbucket.smtp_port`** - SMTP server port for sending test emails (default: 54325).

### Storage (`[storage]`)
- **`storage.enabled`** - Enable object storage service (currently disabled due to CLI v2.34.3 compatibility).
- **`storage.file_size_limit`** - Maximum file upload size (format: "5MB", "50MiB"). Rejects larger uploads.
- **`storage.buckets.{name}.file_size_limit`** - Per-bucket file size limits. Current bucket "images" has 50MiB limit.
- **`storage.buckets.{name}.objects_path`** - Local filesystem path for bucket storage (current: "./images").

### Auth (`[auth]`)
- **`auth.enabled`** - Enable authentication service (default: true).
- **`auth.site_url`** - Base website URL for redirects and email link construction (current: "https://tavern.skogai.se"). Used as redirect allowlist.
- **`auth.additional_redirect_urls`** - Exact URLs permitted for post-authentication redirects (current: ["https://127.0.0.1:3000"]).
- **`auth.jwt_expiry`** - Token validity duration in seconds (default: 3600 = 1 hour, max: 604800 = 1 week).
- **`auth.enable_refresh_token_rotation`** - Tokens reissued on refresh (default: true). Improves security by limiting token lifetime.
- **`auth.refresh_token_reuse_interval`** - Seconds allowing refresh token reuse after expiry (default: 10). Requires rotation enabled.
- **`auth.enable_signup`** - Allow new user registrations (default: true).
- **`auth.enable_anonymous_sign_ins`** - Allow anonymous authentication without credentials (default: false).
- **`auth.enable_manual_linking`** - Allow testing manual account linking between providers (default: false).
- **`auth.minimum_password_length`** - Minimum password characters (default: 6, recommended: 8+). Shorter passwords rejected as weak.
- **`auth.password_requirements`** - Password complexity rules (options: "", "letters_digits", "lower_upper_letters_digits", "lower_upper_letters_digits_symbols").

### Auth Rate Limits (`[auth.rate_limit]`)
- **`auth.rate_limit.email_sent`** - Emails per hour limit (default: 2). Requires SMTP configuration.
- **`auth.rate_limit.sms_sent`** - SMS messages per hour limit (default: 30). Requires SMS provider.
- **`auth.rate_limit.anonymous_users`** - Anonymous sign-ins per hour per IP (default: 30).
- **`auth.rate_limit.token_refresh`** - Session refreshes per 5 minutes per IP (default: 150).
- **`auth.rate_limit.sign_in_sign_ups`** - Sign-up/sign-in requests per 5 minutes per IP (default: 30, excludes anonymous).
- **`auth.rate_limit.token_verifications`** - OTP/Magic link verifications per 5 minutes per IP (default: 30).
- **`auth.rate_limit.web3`** - Web3 logins per 5 minutes per IP (default: 30).

### Auth Email (`[auth.email]`)
- **`auth.email.enable_signup`** - Allow email signups (default: false). Independent from general signup setting.
- **`auth.email.double_confirm_changes`** - Require confirmation on old and new email for changes (default: true). If false, only new email confirms.
- **`auth.email.enable_confirmations`** - Require email confirmation before sign-in (default: false).
- **`auth.email.secure_password_change`** - Require recent authentication for password changes (default: false).
- **`auth.email.max_frequency`** - Minimum time between signup confirmation/password reset emails (default: "1s").
- **`auth.email.otp_length`** - Characters in email OTP code (default: 6).
- **`auth.email.otp_expiry`** - Email OTP expiration in seconds (default: 3600 = 1 hour).

### Auth SMS (`[auth.sms]`)
- **`auth.sms.enable_signup`** - Allow SMS signups (default: false).
- **`auth.sms.enable_confirmations`** - Require phone confirmation before sign-in (default: false).
- **`auth.sms.template`** - OTP message template (default: "Your code is {{ .Code }}").
- **`auth.sms.max_frequency`** - Minimum time between SMS OTP sends (default: "5s").

### Auth Hooks (`[auth.hook.*]`)
- **`auth.hook.before_user_created.enabled`** - Run hook before user creation to validate/reject (default: true). Current URI: "pg-functions://postgres/auth/before-user-created-hook".
- **`auth.hook.custom_access_token.enabled`** - Add custom claims to JWT tokens (default: true). Allows role-based claims from database.

### Auth Providers
- **`auth.external.github.enabled`** - Enable GitHub OAuth login (default: true).
- **`auth.external.github.client_id`** - GitHub OAuth client ID (format: `env(GITHUB_CLIENT_ID)`). Obtained from GitHub OAuth app.
- **`auth.external.github.secret`** - GitHub OAuth client secret (format: `env(GITHUB_CLIENT_SECRET)`). Never commit directly.
- **`auth.external.github.redirect_uri`** - OAuth callback URL (current: "http://localhost:54321/auth/v1/callback").

### MFA (`[auth.mfa]`)
- **`auth.mfa.max_enrolled_factors`** - Maximum MFA factors per user (default: 10).
- **`auth.mfa.totp.enroll_enabled`** - Allow TOTP authenticator app enrollment (default: false).
- **`auth.mfa.phone.enroll_enabled`** - Allow phone-based MFA enrollment (default: false).

### Third-Party Auth (`[auth.third_party.*]`)
- **`auth.third_party.firebase.enabled`** - Use Firebase Auth alongside Supabase (default: false).
- **`auth.third_party.auth0.enabled`** - Use Auth0 alongside Supabase (default: false).
- **`auth.third_party.aws_cognito.enabled`** - Use AWS Cognito/Amplify alongside Supabase (default: false).
- **`auth.third_party.clerk.enabled`** - Use Clerk alongside Supabase (default: false).

### Edge Functions (`[edge_runtime]`)
- **`edge_runtime.enabled`** - Enable Deno edge functions (default: true).
- **`edge_runtime.policy`** - Request handling policy (options: "oneshot", "per_worker"). per_worker enables hot reload during development.
- **`edge_runtime.inspector_port`** - Chrome DevTools inspector port for debugging (default: 8083).
- **`edge_runtime.deno_version`** - Deno major version (default: 2).

### Analytics (`[analytics]`)
- **`analytics.enabled`** - Enable analytics collection (default: true).
- **`analytics.port`** - Analytics service port (default: 54327).
- **`analytics.backend`** - Storage backend (options: "postgres", "bigquery"). Postgres stores in local database.

### Experimental (`[experimental]`)
- **`experimental.orioledb_version`** - Enable OrioleDB storage engine version (default: "" = disabled). Experimental S3-backed storage.
- **`experimental.s3_host`** - S3 bucket URL for OrioleDB (format: `env(S3_HOST)`).
- **`experimental.s3_region`** - S3 bucket region (format: `env(S3_REGION)`).
- **`experimental.s3_access_key`** - AWS_ACCESS_KEY_ID for S3 (format: `env(S3_ACCESS_KEY)`).
- **`experimental.s3_secret_key`** - AWS_SECRET_ACCESS_KEY for S3 (format: `env(S3_SECRET_KEY)`).

---

## Environment Variables

**Primary Source:** `.env.example` (template, not committed), https://supabase.com/docs/guides/self-hosting/docker

### Supabase Core
- **`SUPABASE_URL`** - Supabase instance URL. Read by edge functions (hello-world, openai-chat, openrouter-chat) and examples. Default local: `http://localhost:54321`. Generated during `supabase start`.
- **`SUPABASE_ANON_KEY`** - Public anonymous key for client authentication. Read by edge functions for creating authenticated Supabase clients. Generated during `supabase start`, visible in `supabase status`.
- **`SUPABASE_SERVICE_ROLE_KEY`** - Admin key bypassing RLS with full database access. Read by hello-world (database check), health-check function, scripts/saml-setup.sh (line 33), scripts/check-db-health.sh (line 39-46). Required GitHub Secret for CI/CD.

### Database Connections
- **`DATABASE_URL`** / **`SUPABASE_DIRECT_CONNECTION`** - Direct IPv6 PostgreSQL connection string. Format: `postgresql://postgres:[PASSWORD]@db.[PROJECT-REF].supabase.co:5432/postgres`. Used in health check scripts, MCP connections, test suites (tests/connection_diagnostics.sql, tests/pool_monitoring.sql).
- **`SUPABASE_SESSION_CONNECTION`** / **`SUPABASE_SESSION_POOLER`** - Supavisor session mode connection (port 5432). Format: `postgresql://postgres.[PROJECT-REF]:[PASSWORD]@aws-0-[REGION].pooler.supabase.com:5432/postgres`. For persistent AI agents with stable connections.
- **`SUPABASE_TRANSACTION_CONNECTION`** - Supavisor transaction mode connection (port 6543). Format: `postgresql://postgres.[PROJECT-REF]:[PASSWORD]@aws-0-[REGION].pooler.supabase.com:6543/postgres`. For serverless/edge agents with auto-cleanup.
- **`POSTGRES_PASSWORD`** - Local database password. Default: "postgres". Required in docker-compose for database initialization.
- **`JWT_SECRET`** - Secret for signing JWT tokens. Generated during `supabase init`, used by auth service. Defined in docker-compose .env.

### Connection Pool Configuration
- **`DB_POOL_MIN`** - Minimum connections in pool. Balances startup speed vs idle resource usage.
- **`DB_POOL_MAX`** - Maximum connections in pool. Prevents database connection exhaustion.
- **`DB_POOL_IDLE_TIMEOUT`** - Idle connection timeout in milliseconds. Closes unused connections.
- **`DB_POOL_CONNECTION_TIMEOUT`** - New connection timeout in milliseconds. Fails fast if database unavailable.
- **`SUPABASE_CONNECTION_TYPE`** - Connection mode (options: "direct_ipv6", "supavisor_session", "supavisor_transaction"). Affects prepared statement support and connection behavior.

### AI/LLM API Keys
- **`OPENAI_API_KEY`** - OpenAI API key. Read in supabase/functions/openai-chat/index.ts (line 38) for ChatGPT calls. Also referenced as SUPABASE_OPENAI_API_KEY for Studio AI features (config.toml line 96). Set via: `supabase secrets set OPENAI_API_KEY=your_key_here`.
- **`OPENROUTER_API_KEY`** - OpenRouter API key for multi-model AI access (100+ models). Read in supabase/functions/openrouter-chat/index.ts (line 40). Set via: `supabase secrets set OPENROUTER_API_KEY=sk-or-your_key_here`.

### Authentication & SAML
- **`GOTRUE_SITE_URL`** - Base URL for redirects and emails. Required for auth service. Defined in config.toml or docker-compose environment.
- **`GOTRUE_URI_ALLOW_LIST`** - Comma-separated permitted redirect URLs. Security control for OAuth redirects. Defined in docker-compose.
- **`GOTRUE_JWT_EXP`** - JWT expiration in seconds (default: 3600 = 1 hour, max: 604800 = 1 week). Controls token lifetime.
- **`GOTRUE_DISABLE_SIGNUP`** - Allow/disallow new signups. Boolean control for registration. Defined in docker-compose.
- **`GOTRUE_SAML_ENABLED`** - Enable SAML SSO authentication (default: false). Set in scripts/saml-setup.sh (lines 260-263), docker-compose.override.yml.
- **`GOTRUE_SAML_PRIVATE_KEY`** - Base64-encoded RSA private key for SAML SP. Generated by scripts/saml-setup.sh (lines 210-236), stored in docker-compose.override.yml. Location: /secure/saml/certs/saml_sp_private.key.

### OAuth Providers
- **`GITHUB_CLIENT_ID`** - GitHub OAuth application client ID. Defined in config.toml (line 273) as `env(GITHUB_CLIENT_ID)`. Register at https://github.com/settings/developers.
- **`GITHUB_CLIENT_SECRET`** - GitHub OAuth application client secret. Defined in config.toml (line 274) as `env(GITHUB_CLIENT_SECRET)`. Never commit directly.
- **`SUPABASE_AUTH_EXTERNAL_APPLE_SECRET`** - Apple OAuth secret. Referenced in .env.example for Apple sign-in integration.

### SMS & Email
- **`SUPABASE_AUTH_SMS_TWILIO_AUTH_TOKEN`** - Twilio authentication token for SMS OTP. Defined in config.toml (line 245) as `env(SUPABASE_AUTH_SMS_TWILIO_AUTH_TOKEN)`. Required for SMS-based auth.
- **`SENDGRID_API_KEY`** - SendGrid API key for transactional emails. Used for auth emails (signup confirmation, password reset). Configure in config.toml auth.email.smtp section.
- **`SMTP_*`** - SMTP server credentials (SMTP_HOST, SMTP_PORT, SMTP_USER, SMTP_PASS). Alternative to SendGrid. Defined in docker-compose for production email.

### MCP (Model Context Protocol)
- **`MCP_SERVER_NAME`** - MCP server identifier. Used for AI agent connection tracking.
- **`MCP_SERVER_PORT`** - MCP server listening port. Defines agent communication endpoint.
- **`MCP_CONNECTION_TYPE`** - Connection mode (direct/session/transaction). Determines pooling strategy for AI agents.
- **`MCP_AUDIT_LOGGING_ENABLED`** - Enable query auditing for MCP operations. Logs all agent database queries for compliance.
- **`SUPABASE_AI_AGENT_READONLY_CONNECTION`** - Read-only connection string for AI agents. Prevents accidental data modifications.
- **`SUPABASE_AI_AGENT_READWRITE_CONNECTION`** - Read-write connection string for trusted AI agents. Full database access.
- **`ENABLE_MCP_MONITORING`** - Enable MCP health/performance monitoring. Tracks connection pool usage, query performance.
- **`LOG_LEVEL`** - Logging verbosity (options: debug, info, warn, error). Controls MCP server log output.

### SSL/TLS Configuration
- **`SSL_CERT_PATH`** - Production CA certificate path. For secure database connections. Referenced in certs/README.md.
- **`STAGING_SSL_CERT_PATH`** - Staging CA certificate path. Separate cert for non-production environments.
- **`DB_SSL_MODE`** - PostgreSQL SSL mode (options: disable, allow, prefer, require, verify-ca, verify-full). Security level for database connections.
- **`DB_SSL_REJECT_UNAUTHORIZED`** - Reject connections with invalid certificates (boolean). Node.js specific setting.
- **`PGSSLMODE`** - PostgreSQL client SSL mode environment variable. Alternative to connection string parameters.
- **`PGSSLROOTCERT`** - Path to root certificate for SSL verification. Used with verify-ca or verify-full modes.

### Connection Health & Monitoring
- **`SUPABASE_DIRECT_HEALTH_CHECK_ENABLED`** - Enable automatic connection health checks (boolean). Detects broken connections.
- **`SUPABASE_DIRECT_HEALTH_CHECK_INTERVAL`** - Health check interval in milliseconds. Frequency of connection validation.
- **`SUPABASE_DIRECT_HEALTH_CHECK_TIMEOUT`** - Health check timeout in milliseconds. Max wait time for health check query.
- **`SUPABASE_DIRECT_RETRY_MAX_ATTEMPTS`** - Maximum connection retry attempts. Prevents infinite retry loops.
- **`SUPABASE_DIRECT_RETRY_INITIAL_DELAY`** - Initial retry delay in milliseconds. Exponential backoff starting point.
- **`SUPABASE_DIRECT_RETRY_MAX_DELAY`** - Maximum retry delay in milliseconds. Caps exponential backoff.
- **`SUPABASE_DIRECT_RETRY_BACKOFF_MULTIPLIER`** - Retry delay multiplier for exponential backoff. Typical value: 2.
- **`SUPABASE_CONNECTION_MONITORING_ENABLED`** - Enable connection pool monitoring (boolean). Tracks pool usage metrics.
- **`SUPABASE_CONNECTION_LOG_LEVEL`** - Connection logging verbosity. Separate from general LOG_LEVEL.
- **`SUPABASE_CONNECTION_AUDIT_QUERIES`** - Log all SQL queries (boolean). Performance impact, use for debugging only.

### Testing & Development
- **`FUNCTION_URL`** - Edge function URL for integration tests. Read in supabase/functions/hello-world/test.ts (line 7). Default: `http://localhost:54321/functions/v1/hello-world`.
- **`RUN_INTEGRATION_TESTS`** - Enable integration test execution (any value = enabled). Read in test files (e.g., hello-world/test.ts line 12). Set to skip slow integration tests during development.
- **`TEST_USER_ID`** - Test user UUID for storage/auth examples. Default: `00000000-0000-0000-0000-000000000001` (Alice from seed.sql).

### CI/CD GitHub Secrets
- **`CLAUDE_CODE_OAUTH_TOKEN`** - Claude Code AI integration token. Used in .github/workflows/claude-general.yml (line 27). Optional for AI PR analysis.
- **`SUPABASE_ACCESS_TOKEN`** - Supabase CLI authentication token. Source: Supabase Dashboard → Account → Access Tokens. Required for CI/CD deployments.
- **`SUPABASE_PROJECT_ID`** - Project reference ID. Source: Supabase Dashboard → Project Settings → Reference ID. Links CI/CD to specific project.
- **`SUPABASE_DB_PASSWORD`** - Database password for production deployments. Used in .github/.workflows-backup/deploy.yml (line 55). Separate from local password.

### Studio & Dashboard
- **`DASHBOARD_USERNAME`** - Local Studio web UI login username. Set in .env for basic auth on Studio interface.
- **`DASHBOARD_PASSWORD`** - Local Studio web UI login password. Secures access to http://localhost:8000.
- **`POOLER_TENANT_ID`** - Connection pooler tenant identifier. Internal identifier for multi-tenant pooling.
- **`PG_META_CRYPTO_KEY`** - Encryption key for connection string storage. Used by Studio to encrypt saved database connections.

### Experimental S3 Storage
- **`S3_HOST`** - S3 bucket URL for OrioleDB. Format: `<bucket_name>.s3-<region>.amazonaws.com`. Required for experimental OrioleDB engine.
- **`S3_REGION`** - S3 bucket AWS region (e.g., us-east-1). Defines data locality.
- **`S3_ACCESS_KEY`** - AWS_ACCESS_KEY_ID for S3 bucket access. IAM credentials for S3 operations.
- **`S3_SECRET_KEY`** - AWS_SECRET_ACCESS_KEY for S3 bucket access. Never commit to git, use secrets manager.

### Docker Configuration
- **`DOCKER_SOCKET_LOCATION`** - Docker socket path (e.g., /var/run/docker.sock). Override for rootless Docker installations. Referenced in docker-compose for container management.

---

## Scripts & Automation

**Source:** Agent analysis of `scripts/` directory

### Core Setup
- **`scripts/setup.sh`** - Complete project initialization (Docker check, Supabase CLI install, .env creation, npm install, supabase start, type generation).
- **`scripts/dev.sh`** - Quick development environment start (supabase start + functions serve).
- **`scripts/reset.sh`** - Database reset with confirmation prompt (wrapper for supabase db reset).

### SAML SSO
- **`scripts/saml-setup.sh`** - Automated SAML configuration (certificate generation, environment updates, provider creation, IdP metadata integration). Flags: -d domain, -m metadata-url, -s skip-certs.
- **`scripts/generate-saml-key.sh`** - Standalone RSA 2048-bit key generation for SAML SP with validation.
- **`scripts/test_saml.sh`** - Master SAML test suite orchestrator (calls endpoints, attributes, logs tests).
- **`scripts/test_saml_endpoints.sh`** - SAML endpoint availability validation (metadata, SSO initiation).
- **`scripts/check_saml_logs.sh`** - SAML authentication log analysis from Docker auth service.
- **`scripts/validate_saml_attributes.sh`** - User attribute mapping validation (email, name, first_name, last_name).

### Database Operations
- **`scripts/check-db-health.sh`** - Comprehensive database diagnostics (connection pool, query analysis, locks, table sizes, cache hit ratio).
- **`scripts/test-connection.sh`** - Multi-layered connection testing (DNS, ports, SSL, PostgreSQL version, RLS).
- **`scripts/monitor-session-pool.sh`** - Real-time connection pool monitoring with statistics.
- **`scripts/verify-ssl-connection.sh`** - SSL/TLS certificate validation for database connections.
- **`scripts/rotate-ssl-cert.sh`** - SSL certificate rotation automation with backup.

### GitHub & CI/CD
- **`scripts/claude-quick`** - Smart issue/PR creator based on git state (analyzes changes, creates appropriate GitHub object).
- **`scripts/claude-issue`** - Create GitHub issue with @claude mention for AI assistance.
- **`scripts/claude-pr`** - Create pull request with @claude mention for AI code review.
- **`scripts/auto-create-pr`** - Auto-create PR for Claude branches when work completed.
- **`scripts/auto-merge`** - Auto-merge approved PRs after CI passes.
- **`scripts/claude-status`** - View all Claude AI workflow activity.
- **`scripts/claude-watch`** - Monitor workflow runs with real-time updates.

### Testing & Quality
- **`scripts/verify_npm_scripts.sh`** - Validate all package.json scripts execute without errors.
- **`scripts/lint-and-test`** - Run linting and testing checks in sequence.
- **`scripts/check-mergeable`** - Check pull request mergeability status.
- **`scripts/create-test-issues.sh`** - Generate GitHub issues from test templates for tracking.

### Git Worktrees
- **`scripts/create-all-worktrees.sh`** - Create git worktrees for all open GitHub issues (full checkout).
- **`scripts/create-all-worktrees-minimal.sh`** - Create minimal sparse-checkout worktrees for parallel development.

---

## npm Scripts

**Source:** `package.json` (67 lines)

### Database Operations
- **`npm run db:start`** - Start local Supabase services via Docker (requires Docker running).
- **`npm run db:stop`** - Stop all Supabase Docker containers.
- **`npm run db:reset`** - Drop database, recreate, run all migrations + seed data.
- **`npm run db:status`** - Show running services, ports, and connection strings.
- **`npm run db:diff`** - Generate SQL diff of current schema changes using migra.

### Migrations
- **`npm run migration:new <name>`** - Create new timestamped migration file in supabase/migrations/.
- **`npm run migration:up`** - Apply pending migrations (alias for db:reset).

### Edge Functions
- **`npm run functions:serve`** - Start local edge functions server with hot reload.
- **`npm run functions:new <name>`** - Create new edge function scaffold with index.ts and test.ts.
- **`npm run functions:deploy`** - Deploy all edge functions to production.
- **`npm run lint:functions`** - Lint Deno functions using deno lint.
- **`npm run format:functions`** - Format Deno functions using deno fmt.
- **`npm run test:functions`** - Run all edge function tests with Deno.
- **`npm run test:functions:integration`** - Run integration tests (sets RUN_INTEGRATION_TESTS=true).

### TypeScript Types
- **`npm run types:generate`** - Generate types/database.ts from database schema via Supabase CLI.
- **`npm run types:watch`** - Watch migrations directory and auto-regenerate types on changes.

### Testing
- **`npm run test:rls`** - Test RLS policies using tests/rls_test_suite.sql (comprehensive policy validation).
- **`npm run test:storage`** - Test storage bucket permissions using tests/storage_test_suite.sql.
- **`npm run test:saml`** - Run complete SAML test suite via scripts/test_saml.sh.
- **`npm run test:connection`** - Test database connection with diagnostics via scripts/test-connection.sh.
- **`npm run test:db-health`** - Check database health metrics via scripts/check-db-health.sh.

### Code Quality
- **`npm run lint:sql`** - Lint SQL migrations using sqlfluff (Python tool, requires requirements-dev.txt).

---

## Access URLs (Local Development)

**Source:** `supabase status` output, config.toml port assignments

- **Studio UI:** http://localhost:8000
- **API Gateway:** http://localhost:54321
- **REST API:** http://localhost:54321/rest/v1/
- **Auth API:** http://localhost:54321/auth/v1/
- **Storage API:** http://localhost:54321/storage/v1/
- **Realtime:** http://localhost:54321/realtime/v1/
- **Edge Functions:** http://localhost:54321/functions/v1/<function-name>
- **Database:** postgresql://postgres:postgres@localhost:54322/postgres
- **Connection Pooler:** postgresql://postgres:postgres@localhost:54329/postgres
- **Deno Inspector:** http://localhost:8083 (for edge function debugging)
- **Analytics:** http://localhost:54327

---

## Configuration Precedence

When the same setting appears in multiple places, this is the resolution order:

1. **Environment Variables** (highest priority) - .env file, shell exports, GitHub secrets
2. **config.toml with env()** - References environment variables via `env(VAR_NAME)` syntax
3. **config.toml direct values** - Hard-coded values in config.toml
4. **Script Arguments** - Command-line flags passed to scripts
5. **CLI Defaults** - Supabase CLI built-in defaults
6. **Docker Compose** (self-hosted) - docker-compose.yml service environment sections

---

## Security Notes

**Source:** Official Supabase self-hosting docs, project configuration

- **Never commit:** .env, .env.local, signing_keys.json, certificate private keys (*.key)
- **Use secrets manager:** Production deployments should use HashiCorp Vault, AWS Secrets Manager, or equivalent
- **Rotate credentials:** Change default passwords (DASHBOARD_PASSWORD, POSTGRES_PASSWORD) immediately after setup
- **Restrict network:** Use db.network_restrictions in production to allowlist specific IPs
- **Enable SSL:** Always use SSL/TLS for production database connections (verify-full mode)
- **Limit API access:** Set appropriate auth.rate_limit values to prevent abuse
- **JWT secrets:** db.vault.secret_key and JWT_SECRET must be cryptographically secure random strings

---

## Additional Documentation

**Project-Specific:**
- **CLAUDE.md** - Project instructions and quick reference for Claude Code
- **docs/TROUBLESHOOTING.md** - Comprehensive troubleshooting guide
- **docs/AUTH_ZITADEL_SAML_SELF_HOSTED.md** - Complete SAML integration guide
- **certs/README.md** - SSL/TLS certificate setup and verification

**Official Supabase:**
- **Self-Hosting Guide:** https://supabase.com/docs/guides/self-hosting
- **Docker Setup:** https://supabase.com/docs/guides/self-hosting/docker
- **Auth Config:** https://supabase.com/docs/guides/self-hosting/auth/config
- **CLI Reference:** https://supabase.com/docs/guides/local-development/cli/config
- **Realtime Config:** https://supabase.com/docs/guides/self-hosting/realtime/config
- **Analytics Config:** https://supabase.com/docs/guides/self-hosting/analytics/config
